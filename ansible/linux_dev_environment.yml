---
# Linux Development Environment Setup Playbook
#
# This playbook configures a Linux development environment for WSL (Ubuntu) or RHEL.
# It is designed to be run locally on the target machine.
#
# Usage:
#   # WSL (Ubuntu)
#   ansible-playbook linux_dev_environment.yml -i inventory/localhost.yml --ask-become-pass
#
#   # RHEL
#   ansible-playbook linux_dev_environment.yml -i inventory/localhost.yml --ask-become-pass
#
#   # With git configuration
#   ansible-playbook linux_dev_environment.yml -i inventory/localhost.yml --ask-become-pass \
#     -e "git_user_name='Your Name'" \
#     -e "git_user_email='your.email@example.com'"
#
# Prerequisites:
#   - git and ansible installed (see README.md for bootstrap instructions)
#   - sudo access (--ask-become-pass will prompt for password)

- name: Configure Linux Development Environment
  hosts: localhost
  become: true

  vars_files:
    - "group_vars/all.yml"
    - "group_vars/{{ ansible_os_family }}.yml"

  pre_tasks:
    - name: Display target system information
      ansible.builtin.debug:
        msg: |
          Target System Information:
            - OS Family: {{ ansible_os_family }}
            - Distribution: {{ ansible_distribution }} {{ ansible_distribution_version }}
            - Hostname: {{ ansible_hostname }}
            - User: {{ dev_user }}
            - Home: {{ dev_user_home }}

    - name: Verify supported OS family
      ansible.builtin.assert:
        that:
          - ansible_os_family in ['Debian', 'RedHat']
        fail_msg: "This playbook only supports Debian (Ubuntu/WSL) and RedHat (RHEL) systems."
        success_msg: "OS family {{ ansible_os_family }} is supported."

  roles:
    - role: common_packages
      tags: [packages, common]

    - role: docker
      tags: [docker]

    - role: dev_tools
      tags: [dev_tools, tools]

    - role: dotfiles
      tags: [dotfiles, config]

    - role: ssh_keys
      tags: [ssh, keys]

    - role: vscode
      tags: [vscode, ide]

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: |
          ============================================================
          Development environment setup complete!

          Next steps:
          1. Log out and log back in (or run: newgrp docker)
          2. Add your SSH public key to GitHub:
             cat {{ ssh_key_path }}.pub
          3. Switch git remote to SSH:
             cd ~/dev/dbtools
             git remote set-url origin git@github.com:your-org/dbtools.git
          4. Verify Docker: docker run hello-world
          ============================================================

