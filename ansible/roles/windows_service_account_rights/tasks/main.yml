---
# tasks file for windows_service_account_rights
#
# This role manages Windows User Rights Assignments for the account that runs one (or more)
# Windows services.
#
# Key idea for beginners:
# 1) You provide a list of service "assignments" (service name + rights + desired state).
# 2) For each assignment, the role detects which account the service runs under.
# 3) The role adds/removes the specified rights for that account.

# Basic input validation so mistakes fail fast with a clear message.
- name: Validate windows_service_account_rights_assignments
  ansible.builtin.assert:
    that:
      - windows_service_account_rights_assignments is defined
      - windows_service_account_rights_assignments is iterable
      - windows_service_account_rights_assignments | length > 0
    fail_msg: >-
      windows_service_account_rights_assignments must be a non-empty list.
      Example:
        windows_service_account_rights_assignments:
          - service_name: MSSQLSERVER
            state: present
            rights: [SeServiceLogonRight]

# We keep the per-service logic in a separate task file to make the flow easier
# to follow (especially for novice Ansible users).
- name: Process service account rights assignments
  ansible.builtin.include_tasks: manage_assignment.yml
  loop: "{{ windows_service_account_rights_assignments }}"
  loop_control:
    loop_var: assignment
    label: "{{ assignment.service_name | default('missing-service_name') }}"
