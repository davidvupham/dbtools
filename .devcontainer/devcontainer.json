{
  // ===========================================================================
  // VS Code Dev Container Configuration
  // ===========================================================================
  //
  // PURPOSE:
  // This file configures a development container (dev container) for VS Code.
  // A dev container is a Docker container that serves as a fully-featured
  // development environment with all tools, dependencies, and extensions
  // pre-installed and configured.
  //
  // BENEFITS:
  // 1. Consistent development environment across all developers
  // 2. No need to install Python, databases, or tools on your local machine
  // 3. Isolated from your host system (won't affect other projects)
  // 4. Can run Docker containers inside this dev container (Docker-in-Docker)
  // 5. Automatic VS Code extension installation
  //
  // HOW IT WORKS:
  // When you open this project in VS Code and have the "Dev Containers"
  // extension installed, VS Code will:
  // 1. Build a Docker image from .devcontainer/Dockerfile
  // 2. Start a container from that image
  // 3. Install VS Code extensions inside the container
  // 4. Connect your VS Code window to the running container
  // 5. All terminal commands, file edits, and debugging happen inside container
  //
  // ===========================================================================
  // ---------------------------------------------------------------------------
  // Container Identity
  // ---------------------------------------------------------------------------
  // "name": Display name shown in VS Code UI
  // This helps identify which dev container you're working in
  "name": "dbtools - Ubuntu Miniconda (Py3.13)",
  // ---------------------------------------------------------------------------
  // Build Configuration
  // ---------------------------------------------------------------------------
  // Tells VS Code how to build the Docker image for this dev container
  //
  // "dockerfile": Path to Dockerfile (relative to this .devcontainer directory)
  // "context": Build context directory (parent of .devcontainer)
  //   - This allows Dockerfile to access files in the project root
  // "args": Build-time variables passed to the Dockerfile
  //   - PYTHON_VERSION: Python version to install (3.13)
  //   - CONDA_ENV_NAME: Name of the conda environment (gds)
  //   - DEVCONTAINER_USER: Username to create in container (defaults to host user)
  //   - DEVCONTAINER_UID: User ID (defaults to host user ID)
  //   - DEVCONTAINER_GID: Group ID (defaults to host group ID)
  "build": {
    "dockerfile": "Dockerfile",
    "context": "..",
    "args": {
      "PYTHON_VERSION": "3.13",
      "CONDA_ENV_NAME": "gds",
      "DEVCONTAINER_USER": "${localEnv:USER}",
      "DEVCONTAINER_GROUP": "${localEnv:USER}",
      "DEVCONTAINER_UID": "1000",
      "DEVCONTAINER_GID": "1000"
    }
  },
  // ---------------------------------------------------------------------------
  // User Configuration
  // ---------------------------------------------------------------------------
  // "remoteUser": User account to use inside the container
  // - All VS Code operations run as this user
  // - Matches the user created in Dockerfile (uses host user)
  // - Files created will be owned by this user
  "remoteUser": "${localEnv:USER}",
  // ---------------------------------------------------------------------------
  // Features (Pre-built Capabilities)
  // ---------------------------------------------------------------------------
  // Features are reusable components that add functionality to dev containers
  // They're maintained by Microsoft and the community
  //
  // Available features: https://containers.dev/features
  "features": {
    // common-utils: Basic development utilities (curl, git, etc.)
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": false, // Don't install Zsh (we use Bash)
      "username": "${localEnv:USER}", // User to configure (from host)
      "userUid": "1000", // User ID
      "userGid": "1000" // Group ID
    },
    // git: Git version control (already in base image, ensures it's configured)
    "ghcr.io/devcontainers/features/git:1": {},
    // Docker Outside-of-Docker feature installs Docker CLI and configures access
    // to the host daemon via the mounted socket.
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {
      "version": "latest"
    }
  },
  // ---------------------------------------------------------------------------
  // VS Code Customizations
  // ---------------------------------------------------------------------------
  // Configure VS Code extensions and settings for this dev container
  "customizations": {
    "vscode": {
      // Extensions to install automatically when dev container starts
      // Users don't need to manually install these - they're pre-configured
      "extensions": [
        // Python Development
        "ms-python.python", // Python language support
        "ms-python.vscode-pylance", // Fast Python language server
        "ms-python.debugpy", // Python debugger
        "charliermarsh.ruff", // Fast Python linter/formatter
        // GitHub Copilot
        "GitHub.copilot", // Copilot core extension (remote)
        "GitHub.copilot-chat", // Copilot Chat UI (remote)
        // PowerShell
        "ms-vscode.powershell", // PowerShell language support
        // Testing
        "littlefoxteam.vscode-python-test-adapter", // Test explorer
        "ryanluker.vscode-coverage-gutters", // Show code coverage
        // Database Tools
        "mtxr.sqltools", // Universal database client
        "mtxr.sqltools-driver-pg", // PostgreSQL driver for SQLTools
        "mtxr.sqltools-driver-mssql", // SQL Server driver for SQLTools
        // Jupyter
        "ms-toolsai.jupyter", // Jupyter notebook support
        "ms-toolsai.jupyter-keymap", // Jupyter keyboard shortcuts
        // Docker
        "ms-azuretools.vscode-docker", // Docker management in VS Code
        // Git
        "eamodio.gitlens", // Enhanced Git capabilities
        // Code Quality
        "editorconfig.editorconfig", // EditorConfig support
        "davidanson.vscode-markdownlint", // Markdown linting
        // Utilities
        "visualstudioexptteam.vscodeintellicode", // AI-assisted coding
        "streetsidesoftware.code-spell-checker", // Spell checker
        "redhat.vscode-yaml", // YAML language support
        "tamasfe.even-better-toml" // TOML language support
      ],
      // Settings applied to VS Code when running in this dev container
      // These override user settings and ensure consistency
      "settings": {
        // Python Configuration
        "python.defaultInterpreterPath": "/opt/conda/envs/gds/bin/python",
        "python.terminal.activateEnvironment": true,
        "python.analysis.autoImportCompletions": true,
        "python.analysis.typeCheckingMode": "basic",
        // Testing Configuration
        "python.testing.pytestEnabled": true,
        "python.testing.unittestEnabled": false,
        "python.testing.pytestArgs": [
          ".",
          "-v",
          "--tb=short"
        ],
        "python.testing.autoTestDiscoverOnSaveEnabled": true,
        // Formatting and Linting
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
          "source.organizeImports": "explicit"
        },
        "ruff.enable": true,
        "ruff.organizeImports": true,
        "ruff.fixAll": true,
        // PowerShell
        "powershell.integratedConsole.showOnStartup": false,
        // Editor Settings
        "editor.rulers": [
          88,
          120
        ],
        "editor.tabSize": 4,
        "editor.insertSpaces": true,
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,
        // File Associations
        "files.associations": {
          "*.sql": "sql",
          "*.psql": "sql",
          "Dockerfile*": "dockerfile"
        },
        // Search Exclusions
        "search.exclude": {
          "**/__pycache__": true,
          "**/.pytest_cache": true,
          "**/*.pyc": true,
          "**/htmlcov": true,
          "**/.coverage": true,
          "**/dist": true,
          "**/*.egg-info": true
        },
        // File Watcher Exclusions
        "files.watcherExclude": {
          "**/__pycache__/**": true,
          "**/.pytest_cache/**": true,
          "**/htmlcov/**": true,
          "**/.git/objects/**": true,
          "**/.git/subtree-cache/**": true,
          "**/dist/**": true,
          "**/*.egg-info/**": true
        },
        // Git
        "git.autofetch": true,
        "git.confirmSync": false,
        // Terminal
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.profiles.linux": {
          "bash": {
            "path": "/bin/bash",
            "args": [
              "-l"
            ]
          },
          "pwsh": {
            "path": "/usr/bin/pwsh",
            "args": [
              "-NoLogo"
            ]
          }
        }
      }
    }
  },
  // ---------------------------------------------------------------------------
  // Workspace Configuration
  // ---------------------------------------------------------------------------
  // "workspaceFolder": Where the project is mounted inside the container
  // Your local project directory gets mapped to this path
  "workspaceFolder": "/workspaces/dbtools",
  // ---------------------------------------------------------------------------
  // Initialize Command (Runs on HOST before container starts)
  // ---------------------------------------------------------------------------
  // Creates the tool-library-network if it doesn't exist
  // This network is shared by all database containers and the dev container
  "initializeCommand": "docker network inspect tool-library-network >/dev/null 2>&1 || docker network create --driver bridge tool-library-network",
  // ---------------------------------------------------------------------------
  // Port Forwarding (VS Code Feature)
  // ---------------------------------------------------------------------------
  // "forwardPorts": Ports that VS Code should automatically forward
  //
  // IMPORTANT: This is for VS Code's port forwarding feature (for web apps)
  // NOT the same as publishing Docker ports to WSL host
  // See "runArgs" below for actual Docker port publishing
  //
  // When a service listens on these ports inside the dev container,
  // VS Code will:
  // 1. Detect it
  // 2. Show a notification
  // 3. Make the port accessible from your browser
  "forwardPorts": [
    5432, // PostgreSQL (if running)
    1433, // SQL Server (if running)
    27017, // MongoDB (if running)
    3000, // Common web dev port
    5000, // Common API port
    8000 // Common dev server port
  ],
  // "portsAttributes": Configure how forwarded ports behave
  "portsAttributes": {
    "5432": {
      "label": "PostgreSQL",
      "onAutoForward": "notify" // Show notification when port is forwarded
    },
    "1433": {
      "label": "SQL Server",
      "onAutoForward": "notify"
    },
    "27017": {
      "label": "MongoDB",
      "onAutoForward": "notify"
    },
    "8000": {
      "label": "Dev Server",
      "onAutoForward": "notify"
    }
  },
  // ---------------------------------------------------------------------------
  // Container Runtime Arguments
  // ---------------------------------------------------------------------------
  // "runArgs": Arguments passed to 'docker run' when starting the container
  // These are Docker-level configurations that affect the container itself
  //
  // CRITICAL FOR DATABASE CONNECTIVITY:
  // The -p flags here publish ports from the dev container to the WSL host
  // This enables connecting to databases from outside VS Code
  "runArgs": [
    // Environment variable to prevent Python output buffering
    // Makes print() statements appear immediately in terminal
    "--env",
    "PYTHONUNBUFFERED=1",
    // Mount a Docker volume for VS Code server cache
    // Speeds up dev container rebuilds by preserving VS Code's files
    "--mount",
    "type=volume,source=vscode-server-cache,target=/home/${localEnv:USER}/.vscode-server,consistency=cached",
    // =========================================================================
    // NETWORK: Connect to tool-library-network
    // =========================================================================
    // This connects the dev container to the same Docker network as the
    // database containers (mssql1, mongodb1-3, etc.)
    //
    // CRITICAL for docker-outside-of-docker:
    // - Dev container and database containers run on the same Docker daemon
    // - They need to be on the same network to communicate by container name
    // - Without this, you can't connect to mongodb1, mssql1, etc. from code
    // =========================================================================
    "--network",
    "tool-library-network"
    // =========================================================================
    // PORT PUBLISHING: Not Needed with docker-outside-of-docker
    // =========================================================================
    // With docker-outside-of-docker, database containers run directly on the
    // WSL Docker daemon (not inside the dev container). They publish their own
    // ports via their docker-compose files:
    //
    // CONNECTIVITY:
    // - Dev container → Database containers: Use container names on network
    //   Example: mongodb://mongodb1:27017, Server=mssql1,1433
    //
    // - WSL host → Database containers: Use localhost with published ports
    //   Example: mongodb://localhost:27017, Server=localhost,1433
    //
    // - Windows host → Databases: Windows can access WSL localhost
    //   Example: Same as WSL host (localhost:27017, localhost:1433)
    //
    // Port mappings are handled by each service's docker-compose.yml:
    //   - mssql1: 1433:1433
    //   - mongodb1: 27017:27017
    //   - mongodb2: 27018:27017
    //   - mongodb3: 27019:27017
    //   - psql1: 5432:5432
    //   - psql2: 5433:5432
    //   - kafka1: 9092:9092
    //   - rabbitmq1: 5672:5672, 15672:15672
    // =========================================================================
  ],
  // ---------------------------------------------------------------------------
  // Lifecycle Commands
  // ---------------------------------------------------------------------------
  // These commands run at different stages of the dev container lifecycle
  // "postCreateCommand": Runs ONCE after the container is first created
  // Used for one-time setup: install dependencies, configure environment
  "postCreateCommand": "bash .devcontainer/postCreate.sh",
  // "postStartCommand": Runs EVERY TIME the container starts
  // Used for recurring setup: ensure directories exist, fix permissions
  "postStartCommand": "bash -lc 'mkdir -p ~/.vscode-server/extensions ~/.vscode-server/extensionsCache && chmod -R 775 ~/.vscode-server && chown -R ${USER}:${USER} ~/.vscode-server || true; PY=\"$(command -v python || true)\"; if [ \"$PY\" != \"/opt/conda/envs/gds/bin/python\" ]; then echo \"[postStart] WARNING: default python is $PY; expected /opt/conda/envs/gds/bin/python. New terminals will auto-activate gds; for current shell run: source /opt/conda/etc/profile.d/conda.sh && conda activate gds\"; fi'",
  // ---------------------------------------------------------------------------
  // Container Environment Variables
  // ---------------------------------------------------------------------------
  // "containerEnv": Environment variables set in the container
  // Available to all processes running inside the dev container
  "containerEnv": {
    // Prevents pip from checking for newer versions on every command
    // Speeds up pip operations slightly
    "PIP_DISABLE_PIP_VERSION_CHECK": "1"
  },
  // ---------------------------------------------------------------------------
  // Volume Mounts
  // ---------------------------------------------------------------------------
  // "mounts": Bind mount directories from host to container
  // Format: "source=<host-path>,target=<container-path>,type=bind,..."
  //
  // THESE ARE CRITICAL FOR PERSISTENCE AND FUNCTIONALITY
  "mounts": [
    // SSH Keys Mount (Read-only)
    // Maps your WSL/host SSH keys into the container
    // Enables: git operations, SSH connections to remote servers
    // Read-only for security (container can't modify your SSH keys)
    "source=${localEnv:HOME}/.ssh,target=/home/${localEnv:USER}/.ssh,type=bind,consistency=cached,readonly",
    // /data Persistent Storage Mount
    // Maps /data from host to /data in dev container
    // This is WHERE ALL PERSISTENT DATA LIVES:
    //   - /data/mssql/mssql1 → SQL Server databases
    //   - /data/mongodb → MongoDB replica set data
    //
    // WHY THIS IS CRITICAL:
    // 1. Database containers run INSIDE dev container
    // 2. They write to /data paths INSIDE dev container
    // 3. This mount ensures those writes go to host /data
    // 4. Data survives dev container rebuilds and deletions
    // 5. Data is accessible from host directly
    //
    // EXAMPLE FLOW:
    // SQL Server writes to /var/opt/mssql (inside mssql1 container)
    //   → Mapped to /data/mssql/mssql1 (in dev container)
    //   → This mount maps to /data/mssql/mssql1 (on host)
    //   → Result: Database files persist on host filesystem
    "source=/data,target=/data,type=bind,consistency=cached",
    // /logs Persistent Storage Mount
    // Maps /logs from host to /logs in dev container
    // This is WHERE ALL PERSISTENT LOGS LIVE:
    //   - /logs → Database logs and application logs
    //
    // EXAMPLE FLOW:
    // Database writes to logs (inside database container)
    //   → Mapped to /logs (in dev container)
    //   → This mount maps to /logs (on host)
    //   → Result: Log files persist on host filesystem
    "source=/logs,target=/logs,type=bind,consistency=cached",
    // Docker Socket Mount
    // Mount the host's Docker socket to use Docker from inside the container
    // This allows running Docker commands without starting a daemon inside
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ]
  // ===========================================================================
  // REBUILD INSTRUCTIONS:
  // ===========================================================================
  // After modifying this file, rebuild the dev container:
  // 1. Press F1 or Ctrl+Shift+P
  // 2. Type "Dev Containers: Rebuild Container"
  // 3. Select it and wait for rebuild
  //
  // Changes requiring rebuild:
  // - build.args modifications
  // - features additions/changes
  // - runArgs changes (like port publishing)
  // - mounts changes
  //
  // Changes NOT requiring rebuild (just reload window):
  // - customizations.vscode.settings changes
  // - forwardPorts changes
  // ===========================================================================
}
