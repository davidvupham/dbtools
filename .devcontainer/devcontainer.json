{
  // ===========================================================================
  // VS Code Dev Container Configuration
  // ===========================================================================
  //
  // PURPOSE:
  // This file configures a development container (dev container) for VS Code.
  // A dev container is a Docker container that serves as a fully-featured
  // development environment with all tools, dependencies, and extensions
  // pre-installed and configured.
  //
  // BENEFITS:
  // 1. Consistent development environment across all developers
  // 2. No need to install Python, databases, or tools on your local machine
  // 3. Isolated from your host system (won't affect other projects)
  // 4. Can run Docker containers inside this dev container (Docker-in-Docker)
  // 5. Automatic VS Code extension installation
  //
  // HOW IT WORKS:
  // When you open this project in VS Code and have the "Dev Containers"
  // extension installed, VS Code will:
  // 1. Build a Docker image from .devcontainer/Dockerfile
  // 2. Start a container from that image
  // 3. Install VS Code extensions inside the container
  // 4. Connect your VS Code window to the running container
  // 5. All terminal commands, file edits, and debugging happen inside the container
  //
  // ===========================================================================
  // ---------------------------------------------------------------------------
  // Container Identity
  // ---------------------------------------------------------------------------
  // "name": Display name shown in VS Code UI
  // This helps identify which dev container you're working in
  "name": "GDS Dev Container",
  // ---------------------------------------------------------------------------
  // Build Configuration
  // ---------------------------------------------------------------------------
  // Tells VS Code how to build the Docker image for this dev container
  //
  // "dockerfile": Path to Dockerfile (relative to this .devcontainer directory)
  // "context": Build context directory (parent of .devcontainer)
  //   - This allows Dockerfile to access files in the project root
  // "args": Build-time variables passed to the Dockerfile.
  // These are used to create a non-root user inside the container that matches
  // your host user.
  //
  // Why this matters:
  // - File permissions stay consistent between host and container.
  // - Files created in the container are editable from the host without `sudo`.
  //
  // Notes:
  // - On Linux/macOS these typically exist as environment variables.
  // - On Windows, ${localEnv:UID}/${localEnv:GID} may be empty. In that case the
  //   Dockerfile defaults (1000/1000) are used.
  //
  // Variables:
  // - DEVCONTAINER_USER: Username created in the container (defaults to host USER)
  // - DEVCONTAINER_UID: Numeric user id (defaults to 1000)
  // - DEVCONTAINER_GID: Numeric group id (defaults to 1000)
  "build": {
    "dockerfile": "Dockerfile",
    "context": "..",
    "args": {
      "DEVCONTAINER_USER": "${localEnv:USER}",
      "DEVCONTAINER_UID": "${localEnv:UID}",
      "DEVCONTAINER_GID": "${localEnv:GID}"
    }
  },
  // ---------------------------------------------------------------------------
  // User Configuration
  // ---------------------------------------------------------------------------
  // "remoteUser": User account to use inside the container.
  // - VS Code terminals/debugging run as this user.
  // - Matches the user created in the Dockerfile.
  // - Files created in the workspace are owned by this user.
  "remoteUser": "${localEnv:USER}",
  // "containerUser": User to run the container as (PID 1).
  // We start as root so the container can align Docker socket group permissions
  // before VS Code attaches (docker.sock is a host-mounted file owned by root).
  // Day-to-day work still runs as remoteUser.
  "containerUser": "root",
  // ---------------------------------------------------------------------------
  // Features (Pre-built Capabilities)
  // ---------------------------------------------------------------------------
  // Features are reusable components that add functionality to dev containers
  // They're maintained by Microsoft and the community
  //
  // Available features: https://containers.dev/features
  "features": {},
  // ---------------------------------------------------------------------------
  // VS Code Customizations
  // ---------------------------------------------------------------------------
  // Configure VS Code extensions and settings for this dev container
  "customizations": {
    "vscode": {
      // Extensions to install automatically when dev container starts
      // Users don't need to manually install these - they're pre-configured
      "extensions": [
        // Python Development
        "ms-python.python", // Python language support
        "ms-python.vscode-pylance", // Fast Python language server
        "ms-python.debugpy", // Python debugger
        "charliermarsh.ruff", // Fast Python linter/formatter
        // GitHub Copilot
        "GitHub.copilot", // Copilot core extension (remote)
        "GitHub.copilot-chat", // Copilot Chat UI (remote)
        // PowerShell
        "ms-vscode.powershell", // PowerShell language support
        // Testing
        "littlefoxteam.vscode-python-test-adapter", // Test explorer
        "ryanluker.vscode-coverage-gutters", // Show code coverage
        // Database Tools
        "mtxr.sqltools", // Universal database client
        "mtxr.sqltools-driver-pg", // PostgreSQL driver for SQLTools
        "mtxr.sqltools-driver-mssql", // SQL Server driver for SQLTools
        // Jupyter
        "ms-toolsai.jupyter", // Jupyter notebook support
        "ms-toolsai.jupyter-keymap", // Jupyter keyboard shortcuts
        // Docker
        "ms-azuretools.vscode-docker", // Docker management in VS Code
        // Git
        "eamodio.gitlens", // Enhanced Git capabilities
        // Code Quality
        "editorconfig.editorconfig", // EditorConfig support
        "davidanson.vscode-markdownlint", // Markdown linting
        // Utilities
        "streetsidesoftware.code-spell-checker", // Spell checker
        "redhat.vscode-yaml", // YAML language support
        "tamasfe.even-better-toml" // TOML language support
      ],
      // Settings applied to VS Code when running in this dev container.
      // These override your local VS Code settings for this workspace.
      "settings": {
        // Python Configuration (venv)
        // Provisioned during postCreate via uv. If provisioning fails, the container
        // still has /usr/bin/python3 available.
        "python.defaultInterpreterPath": "/workspaces/devcontainer/dbtools/.venv/bin/python",
        "python.terminal.activateEnvironment": false,
        "python.analysis.autoImportCompletions": true,
        "python.analysis.typeCheckingMode": "basic",
        // Testing Configuration
        "python.testing.pytestEnabled": true,
        "python.testing.unittestEnabled": false,
        "python.testing.pytestArgs": [
          ".",
          "-v",
          "--tb=short"
        ],
        "python.testing.autoTestDiscoverOnSaveEnabled": true,
        // Formatting and Linting
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
          "source.organizeImports": "explicit"
        },
        "ruff.enable": true,
        "ruff.organizeImports": true,
        "ruff.fixAll": true,
        // PowerShell
        "powershell.integratedConsole.showOnStartup": false,
        // Editor Settings
        "editor.rulers": [
          88,
          120
        ],
        "editor.tabSize": 4,
        "editor.insertSpaces": true,
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,
        // File Associations
        "files.associations": {
          "*.sql": "sql",
          "*.psql": "sql",
          "Dockerfile*": "dockerfile"
        },
        // Search Exclusions
        "search.exclude": {
          "**/__pycache__": true,
          "**/.pytest_cache": true,
          "**/*.pyc": true,
          "**/htmlcov": true,
          "**/.coverage": true,
          "**/dist": true,
          "**/*.egg-info": true
        },
        // File Watcher Exclusions
        "files.watcherExclude": {
          "**/__pycache__/**": true,
          "**/.pytest_cache/**": true,
          "**/htmlcov/**": true,
          "**/.git/objects/**": true,
          "**/.git/subtree-cache/**": true,
          "**/dist/**": true,
          "**/*.egg-info/**": true
        },
        // Git
        "git.autofetch": true,
        "git.confirmSync": false,
        // Terminal
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.profiles.linux": {
          "bash": {
            "path": "/bin/bash",
            "args": [
              "-l"
            ]
          },
          "pwsh": {
            "path": "/usr/bin/pwsh",
            "args": [
              "-NoLogo"
            ]
          }
        }
      }
    }
  },
  // ---------------------------------------------------------------------------
  // Workspace Configuration
  // ---------------------------------------------------------------------------
  // "workspaceMount": Override the default mount so that we mount the *parent*
  // directory of this repo into the container. This allows additional repositories
  // to be cloned as siblings of dbtools (e.g. /workspaces/devcontainer/other-repo)
  // instead of nested inside the dbtools repo.
  //
  // Example host layout:
  //   /home/user/src/
  //     dbtools/            (this repo)
  //     other-repo-1/
  //     other-repo-2/
  //
  // Inside the container:
  //   /workspaces/devcontainer/
  //     dbtools/
  //     other-repo-1/
  //     other-repo-2/
  //
  // NOTE: VS Code still opens /workspaces/devcontainer/dbtools as the workspaceFolder.
  "workspaceMount": "source=${localWorkspaceFolder}/..,target=/workspaces/devcontainer,type=bind",
  // "workspaceFolder": Where the project is opened inside the container
  "workspaceFolder": "/workspaces/devcontainer/dbtools",
  // ---------------------------------------------------------------------------
  // Initialize Command (Runs on HOST before container starts)
  // ---------------------------------------------------------------------------
  // Creates the devcontainer-network if it doesn't exist
  // This network is shared by all database containers and the dev container
  "initializeCommand": "docker network inspect devcontainer-network >/dev/null 2>&1 || docker network create --driver bridge devcontainer-network",
  // ---------------------------------------------------------------------------
  // Port Forwarding (VS Code Feature)
  // ---------------------------------------------------------------------------
  // "forwardPorts": Ports that VS Code should automatically forward
  //
  // IMPORTANT: This is for VS Code's port forwarding feature (for web apps)
  // NOT the same as publishing Docker ports to WSL host
  // See "runArgs" below for actual Docker port publishing
  //
  // When a service listens on these ports inside the dev container,
  // VS Code will:
  // 1. Detect it
  // 2. Show a notification
  // 3. Make the port accessible from your browser
  "forwardPorts": [
    5432, // PostgreSQL (if running)
    1433, // SQL Server (if running)
    27017, // MongoDB (if running)
    3000, // Common web dev port
    5000, // Common API port
    8000, // Common dev server port
    8888 // Jupyter (if running jupyter lab)
  ],
  // "portsAttributes": Configure how forwarded ports behave
  "portsAttributes": {
    "5432": {
      "label": "PostgreSQL",
      "onAutoForward": "notify" // Show notification when port is forwarded
    },
    "1433": {
      "label": "SQL Server",
      "onAutoForward": "notify"
    },
    "27017": {
      "label": "MongoDB",
      "onAutoForward": "notify"
    },
    "8000": {
      "label": "Dev Server",
      "onAutoForward": "notify"
    },
    "8888": {
      "label": "Jupyter",
      "onAutoForward": "notify"
    }
  },
  // ---------------------------------------------------------------------------
  // Container Runtime Arguments
  // ---------------------------------------------------------------------------
  // "runArgs": Arguments passed to 'docker run' when starting the container
  // These are Docker-level configurations that affect the container itself
  //
  // Note on ports:
  // - This dev container does NOT publish ports to the host by default.
  // - VS Code can still forward ports you open inside the container via "forwardPorts".
  // - If you need host-level port publishing, add `-p host:container` entries here.
  "runArgs": [
    "--env",
    "PYTHONUNBUFFERED=1",
    "--network",
    "devcontainer-network"
  ],
  // ---------------------------------------------------------------------------
  // Lifecycle Commands
  // ---------------------------------------------------------------------------
  // These commands run at different stages of the dev container lifecycle
  // "postCreateCommand": Runs ONCE after the container is first created
  // Used for one-time setup: install dependencies, configure environment
  "postCreateCommand": "bash -lc '.devcontainer/postCreate.sh'",
  // "postStartCommand": Runs EVERY TIME the container starts
  // Used for recurring setup: ensure directories exist, fix permissions, install local packages
  // ---------------------------------------------------------------------------
  // Container Environment Variables
  // ---------------------------------------------------------------------------
  // "containerEnv": Environment variables set in the container
  // Available to all processes running inside the dev container
  "containerEnv": {
    // Prevents pip from checking for newer versions on every command
    // Speeds up pip operations slightly
    "PIP_DISABLE_PIP_VERSION_CHECK": "1",
    "WORKSPACE_PARENT": "/workspaces/devcontainer",
    "WORKSPACE_REPO": "dbtools",
    "WORKSPACE_ROOT": "/workspaces/devcontainer/dbtools",
    // Optional: set to "1" to install JupyterLab during postCreate
    "ENABLE_JUPYTERLAB": "0"
  },
  // ---------------------------------------------------------------------------
  // Volume Mounts
  // ---------------------------------------------------------------------------
  // "mounts": Bind mount directories from host to container
  // Format: "source=<host-path>,target=<container-path>,type=bind,..."
  //
  // THESE ARE CRITICAL FOR PERSISTENCE AND FUNCTIONALITY
  "mounts": [
    // Read-only SSH keys for git operations.
    // We mount both the host-aligned user home and /home/vscode for compatibility
    // (in case DEVCONTAINER_USER falls back to vscode).
    "source=${localEnv:HOME}/.ssh,target=/home/${localEnv:USER}/.ssh,type=bind,consistency=cached,readonly",
    "source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh,type=bind,consistency=cached,readonly",
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ]
  // ===========================================================================
  // REBUILD INSTRUCTIONS:
  // ===========================================================================
  // After modifying this file, rebuild the dev container:
  // 1. Press F1 or Ctrl+Shift+P
  // 2. Type "Dev Containers: Rebuild Container"
  // 3. Select it and wait for rebuild
  //
  // Changes requiring rebuild:
  // - build.args modifications
  // - features additions/changes
  // - runArgs changes (like port publishing)
  // - mounts changes
  //
  // Changes NOT requiring rebuild (just reload window):
  // - customizations.vscode.settings changes
  // - forwardPorts changes
  // ===========================================================================
}
