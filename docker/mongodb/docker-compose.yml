services:
  mongodb1:
    build:
      context: .
      dockerfile: Dockerfile
    image: gds-mongodb:latest
    container_name: mongodb1
    environment:
      - MONGO_INSTANCE=mongodb1
    ports:
      - "27017:27017"
    volumes:
      # Mount instance-specific data directory
      - /data/mongodb/mongodb1:/data/mongodb/mongodb1
      # Mount instance-specific log directory
      - /logs/mongodb/mongodb1:/logs/mongodb/mongodb1
      # Mount shared keyfile directory
      - /data/mongodb:/data/mongodb
    restart: unless-stopped
    networks:
      - devcontainer-network

  mongodb2:
    build:
      context: .
      dockerfile: Dockerfile
    image: gds-mongodb:latest
    container_name: mongodb2
    environment:
      - MONGO_INSTANCE=mongodb2
    ports:
      - "27018:27017"
    volumes:
      # Mount instance-specific data directory
      - /data/mongodb/mongodb2:/data/mongodb/mongodb2
      # Mount instance-specific log directory
      - /logs/mongodb/mongodb2:/logs/mongodb/mongodb2
      # Mount shared keyfile directory
      - /data/mongodb:/data/mongodb
    restart: unless-stopped
    networks:
      - devcontainer-network

  mongodb3:
    build:
      context: .
      dockerfile: Dockerfile
    image: gds-mongodb:latest
    container_name: mongodb3
    environment:
      - MONGO_INSTANCE=mongodb3
    ports:
      - "27019:27017"
    volumes:
      # Mount instance-specific data directory
      - /data/mongodb/mongodb3:/data/mongodb/mongodb3
      # Mount instance-specific log directory
      - /logs/mongodb/mongodb3:/logs/mongodb/mongodb3
      # Mount shared keyfile directory
      - /data/mongodb:/data/mongodb
    restart: unless-stopped
    networks:
      - devcontainer-network

networks:
  devcontainer-network:
    external: true
